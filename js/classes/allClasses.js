"use strict";let DayNightCycle=class{constructor(){vars.DEBUG?console.log(`%cGenerating the Day Night Cycle`,consts.console.defaults+consts.console.colours.important):null,this.isDayTime=!0,this.isReady=!1,this.crossOverPoint=.73,this.init(),this.beginCycle(),this.currentlyFadingImage=1}init(){vars.DEBUG?console.log(`   >> init`):null,scene.containers?null:scene.containers={};let a=consts.depths.dayNightCycle;this.container=scene.containers.dayNightCycle=scene.add.container().setName("dayNightCycle"),this.container.setDepth(a),this.initBackgrounds(),this.initSunMoon(),this.initSunMoonTween(),this.initTimeOfDay()}initBackgrounds(){this.backgrounds=[];let a=consts.canvas;for(let b=0;6>=b;b++){let c=b?0:1,d=scene.add.image(a.cX,a.cY,"dayNightCycle",`dayNight_${b}`).setAlpha(c);this.container.add(d),this.backgrounds.push(d)}}initSunMoon(){let a=180;this.sun=scene.add.image(-32,a,"dayNightCycle","sun").setOrigin(.5,0),this.sun.startY=a,this.sun.alphaTween=scene.tweens.add({targets:this.sun,alpha:.9,duration:125,repeat:-1,yoyo:!0}),this.moon=scene.add.image(-32,a,"dayNightCycle","moon").setOrigin(.5,0),this.moon.startY=a,this.container.add([this.sun,this.moon])}initSunMoonTween(){vars.DEBUG?console.log(`   >> initSunMoonTween`):null;let a=this.sun;this.sunTweenX=scene.add.tween({targets:a,x:consts.canvas.width+32,duration:120000,repeat:-1,paused:!0,onStart:()=>{vars.DEBUG?console.log(`ðŸŒž Sun Tween X has just started!`):null}});let b=this.moon;this.moonTweenX=scene.add.tween({targets:b,x:consts.canvas.width+32,duration:45000,repeat:-1,paused:!0})}initTimeOfDay(){let a=.73,b=12;this.dayCycleStep=(0|1e3*(a/b))/1e3;let c=0,d=[];for(this.dTFIAI={};c<=a;){let a=(0|1e3*c)/1e3;d.push(a),this.dTFIAI[d.length-1]={value:a,image_int:6>=b?b:13-b},5==12-b&&(c+=this.dayCycleStep,a=(0|1e3*c)/1e3,d.push(a),this.dTFIAI[d.length-1]={value:a,image_int:6},b--),c+=this.dayCycleStep,b--}this.dTFIAI[12]={value:.73,image_int:0}}beginCycle(){this.isReady=!0,this.dayNightCycleTween=scene.tweens.addCounter({from:0,to:1,duration:165000,repeat:-1,onStart:()=>{vars.game.dayNightCycle.startSunTween()},onUpdate:(a,b)=>{vars.game.dayNightCycle.updateCycle(b.value)},onRepeat:()=>{let a=vars.game.dayNightCycle;a.resetCycle()}})}getBGAlpha(a,b){if(!checkType(a,"int")||!checkType(a,"int"))return!1;let c=2===a?(1-b)/2:(1-b)/2+.5;return c*.75}getTimeOfDayImageAlpha(a){if(.73<a)return!1;let b=null,c=null;for(let d in this.dTFIAI)if(a<this.dTFIAI[d].value&&null===b){b={...this.dTFIAI[d],...{index:~~d}},c=this.dTFIAI[~~d-1];break}let d=c.value,e=~~(1e3*((a-d)/this.dayCycleStep))/1e3,f=c.image_int;if(1>f)return!1;if(6<b.index&&(e=1-e),e=Math.clamp(0,1,e),this.backgrounds[f].alpha=e,this.currentlyFadingImage!==f&&this.updateImageNumber(f,e),1===f||2===f){let a=this.getBGAlpha(f,e);vars.phaserObjects.blackMask.setAlpha(a),!vars.game.night&&.25<a&&(vars.game.night?null:vars.game.night=!0,vars.game.generateStars())}}resetCycle(){this.isDayTime=!this.isDayTime,this.moon.x=-32,this.moon.y=this.moon.startY,this.moon.setVisible(!1),this.sun.x=-32,this.sun.y=this.sun.startY,this.sun.setVisible(!0),this.isDayTime=!0}getSinYOffset(a){return!(0>a||1<a)&&(a*=Math.PI,0|164*Math.sin(a))}startMoonTween(){this.sunTweenX.pause(),this.moonTweenX.restart(),this.moonTweenX.play()}startSunTween(){this.moonTweenX.pause(),this.sunTweenX.restart(),this.sunTweenX.play()}updateCycle(a){this.updateIsDayTime(a);let b,c=null;a<=this.crossOverPoint?(b=a/this.crossOverPoint,c="sun"):a>this.crossOverPoint&&(b=(a-this.crossOverPoint)/(1-this.crossOverPoint),c="moon");"sun"===c?(this.sun.y=this.sun.startY-this.getSinYOffset(b),vars.shaders.enabled?vars.shaders.updateSunShaderPosition(this.sun.x,this.sun.y):null,this.moon.visible?this.moon.visible=!1:null,this.sun.visible?null:this.sun.visible=!0):"moon"===c?(this.moon.y=this.moon.startY-this.getSinYOffset(b),this.sun.visible?this.sun.visible=!1:null,this.moon.visible?null:this.moon.visible=!0):void 0;this.getTimeOfDayImageAlpha(a)}updateImageNumber(a,b){let c=null;if(.1>b)c=1;else if(.9<b)c=0;else{console.warn(`Alpha ${b} wasnt in valid range (should have been <0.1 or >0.9)`);debugger;return!1}this.backgrounds[this.currentlyFadingImage].alpha=c,this.currentlyFadingImage=a}updateIsDayTime(a){if(a<=this.crossOverPoint&&!this.isDayTime)return this.isDayTime=!0,vars.DEBUG?console.log(`ðŸŒž Its now day time!`):null,void this.startSunTween();if(a>this.crossOverPoint&&this.isDayTime)return this.isDayTime=!1,vars.DEBUG?console.log(`ðŸŒš Its now night time!\nStarting the moon tween`):null,void this.startMoonTween()}},Fauna=class{constructor(a){if(this.types=["rock","bat","demon_bat","dropper","dragon"],this.randomList=[...this.types].splice(0,4),this.type=a&&this.types.includes(a)?a:shuffle(this.randomList)[0],this.type.includes("bat")){let a=consts.depths.tree_layer;this.depth=getRandom([a-1,consts.depths.enemies])}else this.depth=consts.depths.enemies;this.init(),this.initCollision(),this.addTween()}init(){let a=consts.canvas,b=getRandom(5,8)/10,c=a.height-25,d=getRandom([4,28]);switch(this.type){case"bat":this.depth>consts.depths.tree_layer?(this.object=scene.physics.add.sprite(-32,c-d,"enemies","bat_0"),this.object.setBodySize(.8*this.object.width,.33*this.object.height)):this.object=scene.add.sprite(-32,c-d,"enemies","bat_0");;this.object.setOrigin(.5,1).setScale(b).setDepth(this.depth),this.object.play("enemy_bat"),this.endXY=[a.width+32,null];break;case"demon_bat":this.depth>consts.depths.tree_layer?(this.object=scene.physics.add.sprite(-32,c-d,"enemies","demon_bat_0"),this.object.setBodySize(.8*this.object.width,.33*this.object.height)):this.object=scene.add.sprite(-32,c-d,"enemies","demon_bat_0");;this.object.setOrigin(.5,1).setScale(b).setDepth(this.depth),this.object.play("enemy_demon_bat"),this.endXY=[a.width+32,null];break;case"rock":this.rockMaxYOffset=26,this.object=scene.physics.add.sprite(-32,c-this.rockMaxYOffset,"enemies","rock_0"),this.object.setBodySize(.6*this.object.width,.6*this.object.height),this.object.setOrigin(.5,1).setScale(b).setDepth(this.depth),this.object.play("enemy_rock"),this.endXY=[a.width+32,null];break;case"dragon":this.object=scene.add.sprite(a.width+144,c,"enemies","dragon_0").setOrigin(0).setDepth(this.depth),this.object.play("enemy_dragon"),this.endXY=[-144,null];break;case"dropper":this.object=scene.physics.add.sprite(32,0,"enemies","dropper_0").setOrigin(1).setScale(b).setDepth(this.depth),this.object.setBodySize(.8*this.object.width,.75*this.object.height),this.endXY=[null,c];}this.name=`${this.type}_${generateRandomID()}`,this.object.name=this.name,this.object.type=this.type}initCollision(){let a=vars.player;scene.physics.add.overlap(a.object,this.object,a.class.collideWithEnemy,null,this)}addTween(){null===this.endXY[0]?null===this.endXY[1]?console.warn(`Invalid tween info (not end x or y)`):this.object.tween=scene.tweens.add({targets:this.object,duration:3e3,ease:"Expo.easeIn",y:this.endXY[1],onComplete:(a,b)=>{let c=b[0];switch(c.type){case"dropper":c.play("enemy_dropper"),c.tween=scene.tweens.add({targets:c,x:consts.canvas.width+16,duration:3e3,onComplete:(a,b)=>{let c=b[0];vars.game.destroyEnemyByName(c.name),c.destroy()}});break;default:vars.game.destroyEnemyByName(c.name),c.destroy();}}}):("rock"===this.type&&(this.object.bounceTween=scene.tweens.add({targets:this.object,y:this.object.y+this.rockMaxYOffset,duration:500,yoyo:!0,repeat:-1,ease:"Quad.easeIn"})),this.object.tween=scene.tweens.add({targets:this.object,duration:3e3,x:this.endXY[0],onComplete:(a,b)=>{let c=b[0];vars.game.destroyEnemyByName(c.name),c.destroy()}}))}},Player=class{constructor(){this.invincible=!0,this.gamer=!1,this.alive=!1,this.maxHP=3,this.hp=null,this.score=null,this.highScore=vars.localStorage.highScore,delete vars.localStorage.highScore,this.init()}init(){let a=consts.canvas,b=consts.depths,c=vars.player;vars.anims.initPlayer();let d=a.height-25;this.object=c.object=scene.physics.add.sprite(.75*a.width,d,"beast","beast_idle").setOrigin(.5,1).setDepth(b.player),this.changeHitBox("default"),c.object.groundY=d,c.object.inAir=!1,c.object.sliding=!1,c.object.slideKeyUp=!0,c.object.jumpKeyUp=!0;let e=this.initJumpYOffsets(c.object);c.object.jumpOffsets=e,c.object.jump=()=>{if(!c.object.inAir&&c.object.jumpKeyUp&&!c.object.sliding){c.object.inAir=!0,c.object.jumpKeyUp=!1,c.object.stop(),c.object.setFrame("beast_jump");let a=c.object.jumpOffsets.shift();c.object.jumpOffsets.push(a)}},c.object.slide=()=>{c.object.sliding||!c.object.slideKeyUp||c.object.inAir||(c.object.sliding=!0,c.object.slideKeyUp=!1,c.object.stop(),c.object.setFrame("beast_slide"),c.class.changeHitBox("slide"),scene.tweens.addCounter({from:0,to:1,duration:750,onComplete:()=>{c.object.sliding=!1,c.class.changeHitBox("default"),c.object.play("beast_run")}}))}}initJumpYOffsets(){let b=[];for(let c=0;c<Math.PI;c+=.05)b.push(0|Math.sin(c)*48);return b}changeHitBox(a){"default"===a?this.object.setBodySize(.4*this.object.width,.9*this.object.height):"slide"===a?(this.object.setBodySize(this.object.width,.33*this.object.height),this.object.setOffset(0,34)):"jump"===a?this.object.setBodySize(.4*this.object.width,.6*this.object.height):void 0}collideWithEnemy(){let a=vars.player.class;return a.alive&&!a.invincible&&(a.hp--,vars.phaserObjects.hpText.setText(a.hp),a.hp?void(a.invincible=!0,a.flash()):void a.death())}death(){vars.DEBUG?console.log(`ðŸ•± Player just died!`):null,this.alive=!1;let a=vars.phaserObjects;a.hpText.alphaTween=scene.tweens.add({targets:a.hpText,alpha:0,useFrames:!0,yoyo:!0,duration:10,repeat:-1}),a.scoreText.alphaTween=scene.tweens.add({targets:a.scoreText,alpha:0,useFrames:!0,yoyo:!0,duration:10,repeat:-1});let b=this.object;b.alphaTween=scene.tweens.add({targets:b,alpha:0,useFrames:!0,yoyo:!0,duration:10,repeat:12,onComplete:()=>{delete b.alphaTween}}),this.gamerReset()}fadeOutPlayerUIContainer(){let a=scene.containers.playerUI;scene.tweens.add({targets:a,alpha:0,duration:1500,onComplete:()=>{vars.player.class.resetVars()}})}flash(){scene.tweens.addCounter({from:0,to:1,useFrames:!0,duration:4,yoyo:!0,repeat:10,onUpdate:(a,b)=>{.5<b.value?this.object.setTintFill(16777215):this.object.clearTint()},onComplete:()=>{vars.player.class.invincible=!1}})}gamerEnable(){if(!this.gamer)return this.invincible=!1,this.gamer=!0,this.alive=!0,this.hp=this.maxHP,vars.phaserObjects.hpText.setText(this.hp),this.score=0,scene.containers.playerUI.alpha=1,!0;return!1}gamerReset(){this.invincible=!0;let a=vars.player.class;return scene.tweens.addCounter({from:0,to:1,duration:3500,onComplete:()=>{a.fadeOutPlayerUIContainer()}}),!0}resetVars(){let a=vars.player.class;if(a.gamer=!1,a.alive=!1,a.hp=null,vars.localStorage.saveScore()){vars.DEBUG?console.log(`New high score written to lS`):null;let a=consts.canvas,b=scene.add.text(a.cX,a.cY,"NEW HIGH SCORE !").setOrigin(.5).setAlpha(0).setDepth(consts.depths.playerUI);scene.tweens.addCounter({from:0,to:1,useFrames:!0,duration:4,yoyo:!0,repeat:20,onUpdate:(a,c)=>{b.alpha=.5>c.value?0:1},onComplete:()=>{b.destroy()}})}a.score=null;let b=vars.phaserObjects;b.hpText.alphaTween.remove(),delete b.hpText.alphaTween,b.hpText.alpha=1,b.scoreText.alphaTween.remove(),delete b.scoreText.alphaTween,b.scoreText.alpha=1}update(){this.gamer&&this.alive&&this.updateScore();this.updateJump()}updateJump(){if(!vars.player.object.inAir)return!1;let a=vars.player,b=a.object.jumpOffsets.shift();a.object.jumpOffsets.push(b),a.object.y=a.object.groundY-b,b||(a.object.inAir=!1,a.object.play("beast_run"))}updateScore(){this.score+=1,vars.phaserObjects.scoreText.setText(`Score: ${this.score}`)}};